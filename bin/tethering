#!/usr/bin/awk -f
function quote(str,   d, m, x, y, z) {
  d = "\47"; m = split(str, x, d)
  for (y in x) z = z d x[y] d (y < m ? "\\" d : "")
  return z
}

BEGIN{
     c="ip route show to default via 10.42.0.1"
     c|getline;
     d="nmcli --get-value GENERAL.CONNECTION device show "$3
     d|getline;
     system(sprintf("nmcli connection down %s", quote($2)));
     system(sprintf("nmcli connection modify %s ipv4.method shared", quote($2)));
     system(sprintf("nmcli connection modify %s ipv4.address 10.42.0.81/24", quote($2)));
     system(sprintf("nmcli connection up %s", quote($2)));
}
